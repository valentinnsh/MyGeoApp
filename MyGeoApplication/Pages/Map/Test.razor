@using MyGeoApplication.Services
@using OpenLayers.Blazor
@using Radzen
@page "/test"

@inject IJSRuntime JSRuntime

<OpenStreetMap @ref="_map" Style="height:480px; width:640px" Class="card mb-2" @bind-Center="_center">
</OpenStreetMap>

@code {
    [Inject] NotificationService Notifications { get; set; }
    [Inject] ICityService CityService { get; set; }
    private Coordinate _center = new(7.6, 46.5);
    private OpenStreetMap _map;
    private dynamic _kmlOptions = new { ShowPointNames = true, ExtractStyles = true };

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if(!firstRender) return;
        try
        {
            var defaultCity = await CityService.GetCityByIdAsync("00000000-0000-0000-0000-000000000001");
            _center = new Coordinate(defaultCity.Center.X, defaultCity.Center.Y);
            StateHasChanged();
        }
        catch (Exception e)
        {
            Notifications.Notify(NotificationSeverity.Error, "Could not get SPB");
            Console.WriteLine(e);
        }
    }
}